# Human pancreas CEL-seq2 dataset 

```{r, echo=FALSE}
knitr::opts_chunk$set(cache=TRUE, error=FALSE, warning=FALSE, message=FALSE)
```

## Introduction

## Analysis code

### Data loading

```{r loading}
library(scRNAseq)
sce.muraro <- MuraroPancreasData()
```

### Gene annotation

Converting back to Ensembl identifiers.

```{r gene-annotation}
library(AnnotationHub)
edb <- AnnotationHub()[["AH73881"]]
gene.symb <- sub("__chr.*$", "", rownames(sce.muraro))
gene.ids <- mapIds(edb, keys=gene.symb, 
    keytype="SYMBOL", column="GENEID")

# Removing duplicated genes or genes without Ensembl IDs.
keep <- !is.na(gene.ids) & !duplicated(gene.ids)
sce.muraro <- sce.muraro[keep,]
rownames(sce.muraro) <- gene.ids[keep]
```

### Quality control

```{r quality-control}
library(scater)
qcstats <- perCellQCMetrics(sce.muraro)
filtered <- quickCellQC(qcstats, nmads=3,
    percent_subsets="altexps_ERCC_percent")
sce.muraro <- sce.muraro[,!filtered$discard]
```

### Normalization

```{r normalization}
library(scran)
set.seed(1000)
clusters <- quickCluster(sce.muraro)
sce.muraro <- computeSumFactors(sce.muraro, min.mean=0.1, clusters=clusters)
sce.muraro <- logNormCounts(sce.muraro)
```

### Variance modelling

```{r variance-modelling}
# Blocking on a combined plate and donor factor.
block <- paste0(sce.muraro$plate, "_", sce.muraro$donor)
dec.muraro <- modelGeneVarWithSpikes(sce.muraro, "ERCC", block=block)
```
